<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ—©ç¨²ç”°å¤§å­¦ å—é¨“ç”Ÿã‚µãƒãƒ¼ãƒˆ - ãƒ¯ã‚»ãƒ€ãƒãƒ¼ãƒˆ</title>
<meta name="description" content="æ—©ç¨²ç”°å¤§å­¦ã‚’ç›®æŒ‡ã™å—é¨“ç”Ÿã®ãŸã‚ã®æƒ…å ±ã‚µã‚¤ãƒˆã€‚åœ¨å­¦ç”Ÿã®åˆæ ¼ä½“é¨“è¨˜ã€å­¦éƒ¨ç´¹ä»‹ã€å‹‰å¼·ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€å—é¨“ç”ŸåŒå£«ã®æ²ç¤ºæ¿ãŒæƒã£ã¦ã„ã¾ã™ã€‚">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --crimson: #8B0000; --crimson-light: #A50000; --crimson-dark: #700000; --crimson-pale: #f9f0f0;
    --gold: #C8A951; --gold-light: #e8c96a; --gold-dark: #b8941f;
    --dark: #1a1a1a; --gray: #6b6b6b; --gray-light: #9a9a9a; --gray-lighter: #d5d5d5;
    --white: #ffffff; --border: #e8e0e0; --bg: #faf8f8; --bg-light: #ffffff;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Noto Sans JP', sans-serif; background: var(--bg); color: var(--dark); min-height: 100vh; line-height: 1.6; }

  /* â”€â”€â”€ HEADER â”€â”€â”€ */
  header {
    background: linear-gradient(135deg, var(--crimson) 0%, var(--crimson-dark) 100%);
    padding: 0 1.2rem; position: sticky; top: 0; z-index: 100;
    box-shadow: 0 3px 16px rgba(139,0,0,0.3);
  }
  .header-inner { max-width: 1100px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; height: 58px; gap: 1rem; }
  .logo { display: flex; align-items: center; gap: 8px; text-decoration: none; flex-shrink: 0; }
  .logo-jp { font-size: 1.2rem; font-weight: 900; color: var(--white); white-space: nowrap; }
  .logo-badge { font-size: 0.68rem; background: var(--gold); color: #1a1000; padding: 3px 9px; border-radius: 20px; font-weight: 700; white-space: nowrap; }
  .header-back { color: rgba(255,255,255,0.75); font-size: 0.82rem; text-decoration: none; display: flex; align-items: center; gap: 4px; white-space: nowrap; transition: color 0.2s; flex-shrink: 0; }
  .header-back:hover { color: var(--white); }

  /* â”€â”€â”€ HERO â”€â”€â”€ */
  .hero {
    background: linear-gradient(160deg, var(--crimson-dark) 0%, var(--crimson) 60%, #a52020 100%);
    padding: 64px 1.2rem 56px;
  }
  .hero-inner { max-width: 680px; margin: 0 auto; text-align: center; }
  .hero-label {
    display: inline-block; background: var(--gold); color: #1a1000;
    font-size: 0.72rem; font-weight: 700; padding: 4px 14px; border-radius: 20px;
    margin-bottom: 1rem; letter-spacing: 0.05em;
  }
  .hero-title { font-size: 1.75rem; font-weight: 900; color: var(--white); line-height: 1.45; margin-bottom: 0.8rem; }
  .hero-sub { font-size: 0.92rem; color: rgba(255,255,255,0.82); line-height: 1.75; margin-bottom: 1.8rem; }
  .hero-btns { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
  .btn-hero {
    padding: 11px 24px; border-radius: 8px; font-weight: 700; font-size: 0.88rem;
    text-decoration: none; cursor: pointer; transition: all 0.2s; display: inline-block;
    font-family: 'Noto Sans JP', sans-serif; border: none;
  }
  .btn-hero-solid { background: var(--white); color: var(--crimson); }
  .btn-hero-solid:hover { background: var(--gold); color: #1a1000; }
  .btn-hero-outline { background: transparent; color: var(--white); border: 2px solid rgba(255,255,255,0.55); }
  .btn-hero-outline:hover { background: rgba(255,255,255,0.12); border-color: var(--white); }

  /* â”€â”€â”€ TABS (matches index.html exactly) â”€â”€â”€ */
  .tabs { background: var(--white); border-bottom: 2px solid #f0ede0; position: sticky; top: 58px; z-index: 90; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
  .tabs-inner { padding: 0.6rem 1rem; display: flex; flex-wrap: nowrap; justify-content: flex-start; gap: 0.6rem; max-width: 1100px; margin: 0 auto; overflow-x: auto; scroll-behavior: smooth; }
  .tabs-inner::-webkit-scrollbar { height: 3px; }
  .tabs-inner::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
  .tabs-inner::-webkit-scrollbar-thumb { background: rgba(139,0,0,0.2); border-radius: 2px; }
  .tab { display: inline-block; padding: 7px 13px; font-size: 0.82rem; font-weight: 600; background: white; color: var(--crimson); border: 1.5px solid var(--crimson); border-radius: 18px; cursor: pointer; transition: all 0.2s; text-align: center; white-space: nowrap; letter-spacing: 0.01em; user-select: none; flex-shrink: 0; }
  .tab:hover { background: var(--crimson-pale); }
  .tab.active { background: linear-gradient(135deg, var(--crimson) 0%, var(--crimson-dark) 100%); color: white; border-color: var(--crimson-dark); font-weight: 700; box-shadow: 0 2px 8px rgba(139,0,0,0.2); }

  /* â”€â”€â”€ TAB PANELS â”€â”€â”€ */
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }
  .panel-inner { max-width: 1100px; margin: 0 auto; padding: 48px 1.2rem 64px; }

  /* â”€â”€â”€ SHARED SECTION HEADER â”€â”€â”€ */
  .section-eyebrow { font-size: 0.72rem; font-weight: 700; color: var(--crimson); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 0.35rem; }
  .section-title { font-size: 1.45rem; font-weight: 900; color: var(--dark); margin-bottom: 0.35rem; }
  .section-divider { width: 36px; height: 3px; background: var(--crimson); border-radius: 2px; margin: 0.5rem 0 1rem; }
  .section-sub { font-size: 0.87rem; color: var(--gray); margin-bottom: 1.8rem; line-height: 1.65; }

  /* â”€â”€â”€ FACULTY GRID â”€â”€â”€ */
  .faculty-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 0.9rem; }
  .faculty-card {
    border: 1.5px solid var(--border); border-radius: 12px; padding: 1.15rem;
    background: var(--white); transition: all 0.2s; cursor: pointer;
  }
  .faculty-card:hover { border-color: var(--crimson); box-shadow: 0 4px 18px rgba(139,0,0,0.1); transform: translateY(-2px); }
  .faculty-campus { font-size: 0.68rem; background: var(--crimson-pale); color: var(--crimson); padding: 2px 8px; border-radius: 4px; display: inline-block; margin-bottom: 0.55rem; font-weight: 600; }
  .faculty-name { font-size: 0.97rem; font-weight: 700; color: var(--dark); margin-bottom: 0.25rem; }
  .faculty-eng { font-size: 0.63rem; color: var(--gray-light); font-family: 'Playfair Display', serif; margin-bottom: 0.5rem; line-height: 1.4; }
  .faculty-desc { font-size: 0.79rem; color: var(--gray); line-height: 1.55; margin-bottom: 0.8rem; }
  .faculty-link { font-size: 0.76rem; color: var(--crimson); font-weight: 700; display: flex; align-items: center; gap: 3px; }

  /* â”€â”€â”€ ADVICE / TAIKENKI CARDS â”€â”€â”€ */
  .posts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; }
  .advice-card { border: 1.5px solid var(--border); border-radius: 12px; padding: 1.2rem; background: var(--white); transition: border-color 0.2s; }
  .advice-card:hover { border-color: var(--gray-lighter); }
  .card-tags { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 0.65rem; }
  .card-tag { font-size: 0.7rem; font-weight: 700; padding: 3px 9px; border-radius: 20px; display: inline-block; }
  .tag-advice { background: #e8f4e8; color: #2d7a2d; }
  .tag-taikenki { background: #fff3e0; color: #c65f00; }
  .tag-faculty { background: var(--crimson-pale); color: var(--crimson); }
  .advice-card-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.4rem; }
  .advice-card-body { font-size: 0.82rem; color: var(--gray); line-height: 1.65; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; }
  .advice-card-meta { margin-top: 0.8rem; font-size: 0.74rem; color: var(--gray-light); display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

  /* â”€â”€â”€ EMPTY STATE â”€â”€â”€ */
  .empty-state { text-align: center; padding: 3rem 1.5rem; border: 1.5px dashed var(--border); border-radius: 12px; grid-column: 1 / -1; }
  .empty-state-icon { font-size: 2.5rem; margin-bottom: 0.8rem; }
  .empty-state-title { font-size: 1rem; font-weight: 700; color: var(--gray); margin-bottom: 0.4rem; }
  .empty-state-text { font-size: 0.83rem; color: var(--gray-light); line-height: 1.6; }
  .empty-state-btn { margin-top: 1.2rem; display: inline-block; background: var(--crimson); color: var(--white); padding: 10px 22px; border-radius: 8px; font-size: 0.85rem; font-weight: 700; text-decoration: none; transition: background 0.2s; }
  .empty-state-btn:hover { background: var(--crimson-dark); }

  /* â”€â”€â”€ BULLETIN BOARD â”€â”€â”€ */
  .board-layout { display: grid; grid-template-columns: 320px 1fr; gap: 1.5rem; align-items: start; }
  .post-form-box { background: var(--white); border: 1.5px solid var(--border); border-radius: 14px; padding: 1.4rem; position: sticky; top: 118px; }
  .post-form-title { font-size: 1rem; font-weight: 700; margin-bottom: 1.1rem; color: var(--dark); }
  .form-group { margin-bottom: 0.85rem; }
  .form-label { display: block; font-size: 0.79rem; font-weight: 700; color: var(--dark); margin-bottom: 0.28rem; }
  .form-input { width: 100%; border: 1.5px solid var(--border); border-radius: 8px; padding: 9px 11px; font-size: 0.87rem; font-family: 'Noto Sans JP', sans-serif; transition: border-color 0.2s; background: var(--bg); }
  .form-input:focus { outline: none; border-color: var(--crimson); background: var(--white); }
  .form-select { width: 100%; border: 1.5px solid var(--border); border-radius: 8px; padding: 9px 11px; font-size: 0.87rem; font-family: 'Noto Sans JP', sans-serif; background: var(--bg); cursor: pointer; }
  .form-select:focus { outline: none; border-color: var(--crimson); }
  .form-textarea { width: 100%; border: 1.5px solid var(--border); border-radius: 8px; padding: 10px 11px; font-size: 0.87rem; font-family: 'Noto Sans JP', sans-serif; resize: vertical; min-height: 100px; background: var(--bg); }
  .form-textarea:focus { outline: none; border-color: var(--crimson); background: var(--white); }
  .btn-submit { width: 100%; background: var(--crimson); color: var(--white); border: none; border-radius: 8px; padding: 12px; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: background 0.2s; font-family: 'Noto Sans JP', sans-serif; }
  .btn-submit:hover { background: var(--crimson-light); }
  .btn-submit:disabled { background: var(--gray-lighter); cursor: not-allowed; }
  .form-notice { font-size: 0.7rem; color: var(--gray-light); margin-top: 0.6rem; text-align: center; line-height: 1.5; }

  .board-posts { display: flex; flex-direction: column; gap: 0.75rem; }
  .board-card { background: var(--white); border: 1.5px solid var(--border); border-radius: 12px; padding: 1.05rem 1.15rem; transition: border-color 0.2s; }
  .board-card:hover { border-color: var(--gray-lighter); }
  .board-card-meta { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; margin-bottom: 0.5rem; }
  .board-type-tag { font-size: 0.69rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; white-space: nowrap; }
  .type-soudan    { background: #e3f0ff; color: #1a5cb8; }
  .type-shinchoku { background: #e8f5e9; color: #2e7d32; }
  .type-shitsumon { background: #fff8e1; color: #b77000; }
  .type-zatsudan  { background: #f3e5f5; color: #6a1b9a; }
  .board-faculty-tag { font-size: 0.69rem; background: var(--crimson-pale); color: var(--crimson); padding: 2px 8px; border-radius: 4px; font-weight: 600; white-space: nowrap; }
  .board-card-author { font-size: 0.74rem; color: var(--gray-light); }
  .board-card-time { font-size: 0.7rem; color: var(--gray-lighter); margin-left: auto; white-space: nowrap; }
  .board-card-body { font-size: 0.88rem; color: var(--dark); line-height: 1.65; }
  .board-card-footer { margin-top: 0.65rem; display: flex; gap: 1rem; align-items: center; }
  .board-like { font-size: 0.77rem; color: var(--gray-light); cursor: pointer; transition: color 0.15s; display: flex; align-items: center; gap: 3px; user-select: none; }
  .board-like:hover, .board-like.liked { color: var(--crimson); font-weight: 700; }
  .board-comment-count { font-size: 0.77rem; color: var(--gray-light); }

  /* CTA box inside board tab */
  .cta-box { border: 1.5px solid var(--border); border-radius: 14px; padding: 2rem 1.5rem; text-align: center; background: var(--white); margin-bottom: 1.5rem; }
  .cta-icon { font-size: 2rem; margin-bottom: 0.6rem; }
  .cta-title { font-size: 1.1rem; font-weight: 900; color: var(--dark); margin-bottom: 0.5rem; }
  .cta-sub { font-size: 0.85rem; color: var(--gray); margin-bottom: 1.2rem; line-height: 1.65; }
  .btn-cta { background: var(--crimson); color: var(--white); padding: 11px 28px; border-radius: 8px; font-weight: 700; font-size: 0.9rem; text-decoration: none; display: inline-block; transition: background 0.2s; }
  .btn-cta:hover { background: var(--crimson-dark); }

  /* â”€â”€â”€ AFTER ACCEPTANCE â”€â”€â”€ */
  .after-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 1rem; }
  .after-card { border: 1.5px solid var(--border); border-radius: 12px; padding: 1.3rem; background: var(--white); transition: all 0.2s; }
  .after-card:hover { border-color: var(--gold); box-shadow: 0 4px 14px rgba(200,169,81,0.15); transform: translateY(-2px); }
  .after-card-icon { font-size: 1.8rem; margin-bottom: 0.6rem; }
  .after-card-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 0.35rem; }
  .after-card-desc { font-size: 0.79rem; color: var(--gray); line-height: 1.55; margin-bottom: 0.85rem; }
  .after-card-link { font-size: 0.77rem; color: var(--crimson); font-weight: 700; text-decoration: none; }
  .after-card-link:hover { text-decoration: underline; }

  /* â”€â”€â”€ FOOTER â”€â”€â”€ */
  footer { background: var(--dark); color: rgba(255,255,255,0.55); padding: 2.2rem 1.2rem; }
  .footer-inner { max-width: 700px; margin: 0 auto; text-align: center; }
  .footer-logo { font-size: 1rem; font-weight: 900; color: var(--white); margin-bottom: 0.4rem; }
  .footer-link { color: var(--gold-light); text-decoration: none; }
  .footer-link:hover { text-decoration: underline; }
  .footer-disclaimer { font-size: 0.7rem; line-height: 1.8; margin-top: 1rem; color: rgba(255,255,255,0.35); }

  .loading { text-align: center; padding: 2.5rem; color: var(--gray-light); font-size: 0.87rem; }

  /* â”€â”€â”€ RESPONSIVE â”€â”€â”€ */
  @media (max-width: 992px) {
    .tabs-inner { padding: 0.45rem 0.4rem; gap: 0.35rem; }
    .tab { font-size: 0.75rem; padding: 5px 10px; }
    .tabs { top: 58px; }
  }
  @media (max-width: 900px) {
    .board-layout { grid-template-columns: 1fr; }
    .post-form-box { position: static; }
  }
  @media (max-width: 768px) {
    .panel-inner { padding: 36px 1rem 48px; }
    .hero { padding: 52px 1rem 44px; }
    .hero-title { font-size: 1.4rem; }
    .faculty-grid { grid-template-columns: repeat(2, 1fr); }
    .after-grid { grid-template-columns: repeat(2, 1fr); }
    .hero-btns { flex-direction: column; align-items: center; }
    .btn-hero { width: 100%; max-width: 260px; text-align: center; }
  }
  @media (max-width: 480px) {
    .tabs-inner { padding: 0.4rem 0.3rem; gap: 0.3rem; }
    .tab { font-size: 0.7rem; padding: 4px 8px; }
    .hero-title { font-size: 1.2rem; }
    .section-title { font-size: 1.25rem; }
    .posts-grid { grid-template-columns: 1fr; }
    .faculty-grid { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<!-- â•â•â• HEADER â•â•â• -->
<header>
  <div class="header-inner">
    <a href="https://waseda-ten.vercel.app/" class="logo">
      <span class="logo-jp">ãƒ¯ã‚»ãƒ€ãƒãƒ¼ãƒˆ</span>
      <span class="logo-badge">å—é¨“ç”Ÿã‚µãƒãƒ¼ãƒˆ</span>
    </a>
    <a href="https://waseda-ten.vercel.app/" class="header-back">â† åœ¨å­¦ç”Ÿæ²ç¤ºæ¿ã¸</a>
  </div>
</header>

<!-- â•â•â• HERO â•â•â• -->
<section class="hero">
  <div class="hero-inner">
    <span class="hero-label">æ—©ç¨²ç”°å¤§å­¦ å—é¨“ç”Ÿã‚µãƒãƒ¼ãƒˆ</span>
    <h1 class="hero-title">æ—©ç¨²ç”°ã‚’ç›®æŒ‡ã™äººã®ãŸã‚ã®æƒ…å ±ã‚µã‚¤ãƒˆ</h1>
    <p class="hero-sub">åœ¨å­¦ç”Ÿã®ãƒªã‚¢ãƒ«ãªå£°ã¨ã€åŒã˜ç›®æ¨™ã‚’æŒã¤ä»²é–“ãŒé›†ã¾ã‚‹å ´æ‰€</p>
    <div class="hero-btns">
      <button class="btn-hero btn-hero-solid" onclick="switchTab('board')">åœ¨å­¦ç”Ÿã«è³ªå•ã™ã‚‹</button>
      <button class="btn-hero btn-hero-outline" onclick="switchTab('board')">å—é¨“ç”Ÿæ²ç¤ºæ¿</button>
    </div>
  </div>
</section>

<!-- â•â•â• TABS â•â•â• -->
<div class="tabs">
  <div class="tabs-inner">
    <span class="tab active" data-tab="faculties"  onclick="switchTab('faculties')">ğŸ« å­¦éƒ¨ç´¹ä»‹</span>
    <span class="tab"        data-tab="advice"     onclick="switchTab('advice')">ğŸ“– å‹‰å¼·ã‚¢ãƒ‰ãƒã‚¤ã‚¹</span>
    <span class="tab"        data-tab="board"      onclick="switchTab('board')">ğŸ’¬ å—é¨“ç”Ÿæ²ç¤ºæ¿</span>
    <span class="tab"        data-tab="taikenki"   onclick="switchTab('taikenki')">ğŸ† åˆæ ¼ä½“é¨“è¨˜</span>
    <span class="tab"        data-tab="after"      onclick="switchTab('after')">ğŸ“ åˆæ ¼å¾Œã®æº–å‚™</span>
  </div>
</div>

<!-- â•â•â• PANEL: å­¦éƒ¨ç´¹ä»‹ â•â•â• -->
<div id="panel-faculties" class="tab-panel active">
  <div class="panel-inner">
    <div class="section-eyebrow">å¿—æœ›æ ¡é¸ã³</div>
    <h2 class="section-title">å­¦éƒ¨ç´¹ä»‹</h2>
    <div class="section-divider"></div>
    <p class="section-sub">æ—©ç¨²ç”°å¤§å­¦ã®13å­¦éƒ¨ãã‚Œãã‚Œã®ç‰¹è‰²ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚æ°—ã«ãªã‚‹å­¦éƒ¨ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ²ç¤ºæ¿ã§è³ªå•ã§ãã¾ã™ã€‚</p>
    <div class="faculty-grid" id="faculty-grid"><!-- JSã§æç”» --></div>
  </div>
</div>

<!-- â•â•â• PANEL: å‹‰å¼·ã‚¢ãƒ‰ãƒã‚¤ã‚¹ â•â•â• -->
<div id="panel-advice" class="tab-panel">
  <div class="panel-inner">
    <div class="section-eyebrow">å…ˆè¼©ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</div>
    <h2 class="section-title">å‹‰å¼·ãƒ»å—é¨“ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h2>
    <div class="section-divider"></div>
    <p class="section-sub">æ—©ç¨²ç”°åœ¨å­¦ç”Ÿãƒ»å’æ¥­ç”Ÿã«ã‚ˆã‚‹å—é¨“å‹‰å¼·ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚</p>
    <div id="advice-posts" class="posts-grid"><div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></div>
  </div>
</div>

<!-- â•â•â• PANEL: å—é¨“ç”Ÿæ²ç¤ºæ¿ â•â•â• -->
<div id="panel-board" class="tab-panel">
  <div class="panel-inner">
    <!-- åœ¨å­¦ç”Ÿã«è³ªå• CTA -->
    <div class="cta-box">
      <div class="cta-icon">ğŸ’¬</div>
      <div class="cta-title">æ—©ç¨²ç”°ç”Ÿã«ç›´æ¥èã„ã¦ã¿ã‚ˆã†</div>
      <p class="cta-sub">æˆæ¥­ãƒ»ã‚µãƒ¼ã‚¯ãƒ«ãƒ»ä¸€äººæš®ã‚‰ã—ãƒ»å°±æ´»â€”â€”åœ¨å­¦ç”ŸãŒãƒªã‚¢ãƒ«ãªä½“é¨“ã‚’ã‚‚ã¨ã«å›ç­”ã—ã¾ã™ã€‚</p>
      <a href="https://waseda-ten.vercel.app/" class="btn-cta">Q&amp;Aæ²ç¤ºæ¿ã§è³ªå•ã™ã‚‹ â†’</a>
    </div>

    <div class="section-eyebrow">å—é¨“ç”Ÿã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</div>
    <h2 class="section-title">å—é¨“ç”Ÿæ²ç¤ºæ¿</h2>
    <div class="section-divider"></div>
    <p class="section-sub">åŒã˜ç›®æ¨™ã‚’æŒã¤ä»²é–“ã¨æƒ…å ±äº¤æ›ãƒ»é€²æ—å ±å‘ŠãŒã§ãã‚‹å ´æ‰€ã§ã™ã€‚</p>
    <div class="board-layout">
      <div class="post-form-box">
        <div class="post-form-title">ğŸ“ æŠ•ç¨¿ã™ã‚‹</div>
        <div class="form-group">
          <label class="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ  <span style="color:#e74c3c;">*</span></label>
          <input class="form-input" type="text" id="boardNickname" placeholder="ä¾‹ï¼šæ—©ç¨²ç”°å¿—æœ›19æ­³" maxlength="20">
        </div>
        <div class="form-group">
          <label class="form-label">å¿—æœ›å­¦éƒ¨</label>
          <select class="form-select" id="boardFaculty">
            <option value="">å­¦éƒ¨ã‚’é¸æŠï¼ˆä»»æ„ï¼‰</option>
            <option value="seikei">æ”¿æ²»çµŒæ¸ˆå­¦éƒ¨</option>
            <option value="ho">æ³•å­¦éƒ¨</option>
            <option value="shogaku">å•†å­¦éƒ¨</option>
            <option value="kyoiku">æ•™è‚²å­¦éƒ¨</option>
            <option value="bun">æ–‡å­¦éƒ¨</option>
            <option value="bunkagaku">æ–‡åŒ–æ§‹æƒ³å­¦éƒ¨</option>
            <option value="kiso">åŸºå¹¹ç†å·¥å­¦éƒ¨</option>
            <option value="sozo">å‰µé€ ç†å·¥å­¦éƒ¨</option>
            <option value="sentan">å…ˆé€²ç†å·¥å­¦éƒ¨</option>
            <option value="ningen">äººé–“ç§‘å­¦éƒ¨</option>
            <option value="sports">ã‚¹ãƒãƒ¼ãƒ„ç§‘å­¦éƒ¨</option>
            <option value="kokusai">å›½éš›æ•™é¤Šå­¦éƒ¨</option>
            <option value="shakou">ç¤¾ä¼šç§‘å­¦éƒ¨</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">æŠ•ç¨¿ç¨®åˆ¥ <span style="color:#e74c3c;">*</span></label>
          <select class="form-select" id="boardType">
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ç›¸è«‡">ç›¸è«‡</option>
            <option value="é€²æ—å ±å‘Š">é€²æ—å ±å‘Š</option>
            <option value="è³ªå•">è³ªå•</option>
            <option value="é›‘è«‡">é›‘è«‡</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">æœ¬æ–‡ <span style="color:#e74c3c;">*</span></label>
          <textarea class="form-textarea" id="boardBody" placeholder="æ°—ã«ãªã‚‹ã“ã¨ã‚„é€²æ—ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„..."></textarea>
        </div>
        <button class="btn-submit" id="boardSubmitBtn" onclick="submitBoardPost()">æŠ•ç¨¿ã™ã‚‹</button>
        <p class="form-notice">æŠ•ç¨¿å†…å®¹ã«ã¯è²¬ä»»ã‚’æŒã¡ã€è‰¯è­˜ã‚ã‚‹æŠ•ç¨¿ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</p>
      </div>
      <div id="board-posts" class="board-posts">
        <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• PANEL: åˆæ ¼ä½“é¨“è¨˜ â•â•â• -->
<div id="panel-taikenki" class="tab-panel">
  <div class="panel-inner">
    <div class="section-eyebrow">å…ˆè¼©ã®åˆæ ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</div>
    <h2 class="section-title">åˆæ ¼ä½“é¨“è¨˜</h2>
    <div class="section-divider"></div>
    <p class="section-sub">å—é¨“æœ¬ç•ªã¾ã§ã®ãƒªã‚¢ãƒ«ãªå£°ã€‚åˆæ ¼ã—ãŸå…ˆè¼©ãŸã¡ã®ä½“é¨“è¨˜ã‚’å±Šã‘ã¾ã™ã€‚</p>
    <div id="taikenki-posts" class="posts-grid"><div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div></div>
  </div>
</div>

<!-- â•â•â• PANEL: åˆæ ¼å¾Œã®æº–å‚™ â•â•â• -->
<div id="panel-after" class="tab-panel">
  <div class="panel-inner">
    <div class="section-eyebrow">åˆæ ¼ã—ãŸæ–¹ã¸</div>
    <h2 class="section-title">åˆæ ¼å¾Œã®æº–å‚™</h2>
    <div class="section-divider"></div>
    <p class="section-sub">åˆæ ¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚å…¥å­¦å‰ã«ç¢ºèªã—ã¦ãŠããŸã„ã“ã¨ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚</p>
    <div class="after-grid">
      <div class="after-card">
        <div class="after-card-icon">ğŸ“‹</div>
        <div class="after-card-title">å…¥å­¦æ‰‹ç¶šã</div>
        <div class="after-card-desc">å…¥å­¦é‡‘ãƒ»æˆæ¥­æ–™ã®æ”¯æ‰•ã„ã‚„æ›¸é¡æå‡ºã®ç· åˆ‡ãªã©ã€æ‰‹ç¶šãã®æµã‚Œã‚’å…ˆè¼©ã«ç¢ºèªã—ã‚ˆã†ã€‚</div>
        <a href="https://waseda-ten.vercel.app/" class="after-card-link">åœ¨å­¦ç”Ÿã«èã â†’</a>
      </div>
      <div class="after-card">
        <div class="after-card-icon">ğŸ </div>
        <div class="after-card-title">ä¸€äººæš®ã‚‰ã—æº–å‚™</div>
        <div class="after-card-desc">æ—©ç¨²ç”°å‘¨è¾ºã®å®¶è³ƒç›¸å ´ãƒ»ãŠã™ã™ã‚ã‚¨ãƒªã‚¢ãƒ»å¼•è¶Šã—æ™‚æœŸã®æ³¨æ„ç‚¹ãªã©ã€‚</div>
        <a href="https://waseda-ten.vercel.app/" class="after-card-link">åœ¨å­¦ç”Ÿã«èã â†’</a>
      </div>
      <div class="after-card">
        <div class="after-card-icon">ğŸ¯</div>
        <div class="after-card-title">ã‚µãƒ¼ã‚¯ãƒ«æƒ…å ±</div>
        <div class="after-card-desc">æ–°æ­“ã®æ™‚æœŸã€äººæ°—ã‚µãƒ¼ã‚¯ãƒ«ã€å…¼ã‚µãƒ¼ã®å®Ÿæ…‹ã¾ã§å…ˆè¼©ã‹ã‚‰æ•™ãˆã¦ã‚‚ã‚‰ãŠã†ã€‚</div>
        <a href="https://waseda-ten.vercel.app/" class="after-card-link">ã‚µãƒ¼ã‚¯ãƒ«æƒ…å ±ã‚’è¦‹ã‚‹ â†’</a>
      </div>
      <div class="after-card">
        <div class="after-card-icon">ğŸ“š</div>
        <div class="after-card-title">å±¥ä¿®ç™»éŒ²</div>
        <div class="after-card-desc">åˆã‚ã¦ã®å±¥ä¿®ç™»éŒ²ã¯æˆ¸æƒ‘ã†ã“ã¨ã‚‚ã€‚å˜ä½ã®å–ã‚Šæ–¹ã‚’å…ˆè¼©ã®æˆæ¥­å£ã‚³ãƒŸã§ç¢ºèªã—ã‚ˆã†ã€‚</div>
        <a href="https://waseda-ten.vercel.app/" class="after-card-link">æˆæ¥­å£ã‚³ãƒŸã‚’è¦‹ã‚‹ â†’</a>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• FOOTER â•â•â• -->
<footer>
  <div class="footer-inner">
    <div class="footer-logo">ãƒ¯ã‚»ãƒ€ãƒãƒ¼ãƒˆ</div>
    <p style="font-size:0.82rem;margin-bottom:0.3rem;">
      <a href="https://waseda-ten.vercel.app/" class="footer-link">åœ¨å­¦ç”Ÿæ²ç¤ºæ¿ã¸æˆ»ã‚‹</a>
    </p>
    <div class="footer-disclaimer">
      æœ¬ã‚µã‚¤ãƒˆã¯æ—©ç¨²ç”°å¤§å­¦ã®å…¬å¼ã‚µã‚¤ãƒˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ²è¼‰æƒ…å ±ã¯ã™ã¹ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æŠ•ç¨¿ã§ã‚ã‚Šã€å†…å®¹ã®æ­£ç¢ºæ€§ã‚’ä¿è¨¼ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<br>
      å—é¨“ã«é–¢ã™ã‚‹æ­£ç¢ºãªæƒ…å ±ã¯å¿…ãš<a href="https://www.waseda.jp/" class="footer-link" target="_blank" rel="noopener">æ—©ç¨²ç”°å¤§å­¦å…¬å¼ã‚µã‚¤ãƒˆ</a>ã§ã”ç¢ºèªãã ã•ã„ã€‚<br>
      Â© ãƒ¯ã‚»ãƒ€ãƒãƒ¼ãƒˆ â€” æ—©ç¨²ç”°å¤§å­¦ç”Ÿã«ã‚ˆã‚‹éå…¬å¼æƒ…å ±å…±æœ‰ã‚µãƒ¼ãƒ“ã‚¹
    </div>
  </div>
</footer>

<script>
// â”€â”€ Supabase åˆæœŸåŒ– â”€â”€
const SUPABASE_URL = 'https://hazntivymzywhowtdtcc.supabase.co';
const SUPABASE_ANON_KEY = 'sb_publishable_Mr1wt5ZOoLtmYqPEoIKeUw_cM4ZPSbN';
let db;
try {
  if (typeof createClient === 'function') db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  else if (window.supabase && typeof window.supabase.createClient === 'function') db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
} catch(e) { console.error('Supabase init:', e); }

// â”€â”€ å®šæ•° â”€â”€
const FACULTIES = {
  seikei:'æ”¿æ²»çµŒæ¸ˆå­¦éƒ¨', ho:'æ³•å­¦éƒ¨', shogaku:'å•†å­¦éƒ¨', kyoiku:'æ•™è‚²å­¦éƒ¨',
  bun:'æ–‡å­¦éƒ¨', bunkagaku:'æ–‡åŒ–æ§‹æƒ³å­¦éƒ¨', kiso:'åŸºå¹¹ç†å·¥å­¦éƒ¨', sozo:'å‰µé€ ç†å·¥å­¦éƒ¨',
  sentan:'å…ˆé€²ç†å·¥å­¦éƒ¨', ningen:'äººé–“ç§‘å­¦éƒ¨', sports:'ã‚¹ãƒãƒ¼ãƒ„ç§‘å­¦éƒ¨',
  kokusai:'å›½éš›æ•™é¤Šå­¦éƒ¨', shakou:'ç¤¾ä¼šç§‘å­¦éƒ¨'
};
const FACULTY_DATA = [
  { key:'seikei',   name:'æ”¿æ²»çµŒæ¸ˆå­¦éƒ¨', eng:'Political Science & Economics',    campus:'æ—©ç¨²ç”°',   desc:'æ”¿æ²»ãƒ»çµŒæ¸ˆãƒ»å›½éš›æ”¿æ²»çµŒæ¸ˆã®3å°‚æ”»ã€‚æ–‡ç³»ã®çœ‹æ¿å­¦éƒ¨ã€‚' },
  { key:'ho',       name:'æ³•å­¦éƒ¨',       eng:'Law',                              campus:'æ—©ç¨²ç”°',   desc:'æ³•å¾‹ãƒ»æ”¿æ²»ã®2å°‚æ”»ã€‚å¸æ³•è©¦é¨“ãƒ»å…¬å‹™å“¡ãƒ»ä¼æ¥­æ³•å‹™ã«å¼·ã„ã€‚' },
  { key:'shogaku',  name:'å•†å­¦éƒ¨',       eng:'Commerce',                         campus:'æ—©ç¨²ç”°',   desc:'çµŒå–¶ãƒ»ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°ãƒ»ä¼šè¨ˆã€‚å°±è·ç‡ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã€‚' },
  { key:'kyoiku',   name:'æ•™è‚²å­¦éƒ¨',     eng:'Education',                        campus:'æ—©ç¨²ç”°',   desc:'å¤šå½©ãªå°‚ä¿®ã‚’æŒã¤ç·åˆå­¦éƒ¨ã€‚æ•™å“¡å…è¨±å–å¾—ã‚‚å¯èƒ½ã€‚' },
  { key:'bun',      name:'æ–‡å­¦éƒ¨',       eng:'Humanities & Social Sciences',     campus:'æ—©ç¨²ç”°',   desc:'æ–‡å­¦ãƒ»èªå­¦ãƒ»æ–‡åŒ–ã‚’æ·±ãå­¦ã¶äººæ–‡å­¦ã®ä¼çµ±å­¦éƒ¨ã€‚' },
  { key:'bunkagaku',name:'æ–‡åŒ–æ§‹æƒ³å­¦éƒ¨', eng:'Culture, Media & Society',         campus:'æ—©ç¨²ç”°',   desc:'æ–‡åŒ–ãƒ»ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ»è¡¨è±¡ã‚’å¤šè§’çš„ã«å­¦ã¶å­¦éƒ¨ã€‚' },
  { key:'kiso',     name:'åŸºå¹¹ç†å·¥å­¦éƒ¨', eng:'Fundamental Sci. & Engineering',   campus:'è¥¿æ—©ç¨²ç”°', desc:'æ•°å­¦ãƒ»æƒ…å ±ãƒ»é›»æ°—é›»å­ãŒä¸­å¿ƒã®ç†å·¥å­¦éƒ¨ã€‚' },
  { key:'sozo',     name:'å‰µé€ ç†å·¥å­¦éƒ¨', eng:'Creative Sci. & Engineering',      campus:'è¥¿æ—©ç¨²ç”°', desc:'å»ºç¯‰ãƒ»æ©Ÿæ¢°ãƒ»ç’°å¢ƒè³‡æºã€‚ã‚‚ã®ã¥ãã‚Šã«ç‰¹åŒ–ã—ãŸç†å·¥å­¦éƒ¨ã€‚' },
  { key:'sentan',   name:'å…ˆé€²ç†å·¥å­¦éƒ¨', eng:'Advanced Sci. & Engineering',      campus:'è¥¿æ—©ç¨²ç”°', desc:'ç‰©ç†ãƒ»åŒ–å­¦ãƒ»ç”Ÿå‘½åŒ»ç§‘å­¦ã€‚æœ€å…ˆç«¯ç ”ç©¶ã‚’ç›®æŒ‡ã™å­¦éƒ¨ã€‚' },
  { key:'ningen',   name:'äººé–“ç§‘å­¦éƒ¨',   eng:'Human Sciences',                   campus:'æ‰€æ²¢',     desc:'å¿ƒç†ãƒ»æ•™è‚²ãƒ»ç¤¾ä¼šå­¦ã®èåˆã€‚æ‰€æ²¢ã‚­ãƒ£ãƒ³ãƒ‘ã‚¹ã€‚' },
  { key:'sports',   name:'ã‚¹ãƒãƒ¼ãƒ„ç§‘å­¦éƒ¨',eng:'Sport Sciences',                  campus:'æ‰€æ²¢',     desc:'ã‚¹ãƒãƒ¼ãƒ„ã‚’ç§‘å­¦ãƒ»äººæ–‡ç¤¾ä¼šã®è¦–ç‚¹ã‹ã‚‰å­¦ã¶å­¦éƒ¨ã€‚' },
  { key:'kokusai',  name:'å›½éš›æ•™é¤Šå­¦éƒ¨', eng:'International Liberal Studies',    campus:'æ—©ç¨²ç”°',   desc:'è‹±èªã§å­¦ã¶ãƒªãƒ™ãƒ©ãƒ«ã‚¢ãƒ¼ãƒ„ã€‚é«˜ã„è‹±èªåŠ›ãŒæ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚' },
  { key:'shakou',   name:'ç¤¾ä¼šç§‘å­¦éƒ¨',   eng:'Social Sciences',                  campus:'æ—©ç¨²ç”°',   desc:'æ–‡ç†èåˆã§ç¤¾ä¼šç¾è±¡ã‚’å¤šè§’çš„ã«åˆ†æã™ã‚‹å­¦éƒ¨ã€‚' },
];
const TYPE_CLASSES = { 'ç›¸è«‡':'type-soudan', 'é€²æ—å ±å‘Š':'type-shinchoku', 'è³ªå•':'type-shitsumon', 'é›‘è«‡':'type-zatsudan' };

// â”€â”€ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â”€â”€
function escHtml(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function formatTime(ts) {
  const d = Math.floor((Date.now() - new Date(ts)) / 1000);
  if (d < 60) return 'ãŸã£ãŸä»Š';
  if (d < 3600) return Math.floor(d/60)+'åˆ†å‰';
  if (d < 86400) return Math.floor(d/3600)+'æ™‚é–“å‰';
  return Math.floor(d/86400)+'æ—¥å‰';
}
function getDeviceId() {
  let id = localStorage.getItem('waseda_device_id');
  if (!id) { id = 'dev_'+Math.random().toString(36).substr(2,9)+'_'+Date.now().toString(36); localStorage.setItem('waseda_device_id', id); }
  return id;
}
function getLikedPosts() { try { return new Set(JSON.parse(localStorage.getItem('waseda_liked')||'[]')); } catch { return new Set(); } }
function setPostLiked(id, liked) { const s = getLikedPosts(); liked ? s.add(String(id)) : s.delete(String(id)); localStorage.setItem('waseda_liked', JSON.stringify([...s])); }

// â”€â”€ ã‚¿ãƒ–åˆ‡æ›¿ â”€â”€
let currentTab = 'faculties';

function switchTab(tab) {
  // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  // ãƒ‘ãƒãƒ«ã®è¡¨ç¤ºåˆ‡æ›¿
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-' + tab).classList.add('active');
  currentTab = tab;
  // ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆã‚¿ãƒ–ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ï¼‰
  document.querySelector('.tabs').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// â”€â”€ å­¦éƒ¨ã‚°ãƒªãƒƒãƒ‰ â”€â”€
function renderFacultyGrid() {
  document.getElementById('faculty-grid').innerHTML = FACULTY_DATA.map(f => `
    <div class="faculty-card" onclick="focusBoardWithFaculty('${f.key}')">
      <span class="faculty-campus">ğŸ“ ${f.campus}</span>
      <div class="faculty-name">${f.name}</div>
      <div class="faculty-eng">${f.eng}</div>
      <div class="faculty-desc">${f.desc}</div>
      <span class="faculty-link">æ²ç¤ºæ¿ã§è³ªå•ã™ã‚‹ â†’</span>
    </div>
  `).join('');
}

function focusBoardWithFaculty(key) {
  switchTab('board');
  setTimeout(() => {
    document.getElementById('boardFaculty').value = key;
    document.getElementById('boardBody').focus();
  }, 50);
}

// â”€â”€ ã‚¢ãƒ‰ãƒã‚¤ã‚¹æŠ•ç¨¿ â”€â”€
async function loadAdvicePosts() {
  const el = document.getElementById('advice-posts');
  if (!db) { el.innerHTML = emptyState('ğŸ“–','ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å‹Ÿé›†ä¸­','åœ¨å­¦ç”Ÿã®çš†ã•ã‚“ã€å—é¨“ç”Ÿã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚',false); return; }
  try {
    const { data, error } = await db.from('posts').select('*')
      .eq('category','juken').eq('circle_type','advice')
      .order('created_at',{ascending:false}).limit(9);
    if (error) throw error;
    if (!data || !data.length) {
      el.innerHTML = emptyState('ğŸ“–','ã¾ã ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“','åœ¨å­¦ç”Ÿã®çš†ã•ã‚“ã€ãœã²å—é¨“ç”Ÿã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ï¼',true);
      return;
    }
    el.innerHTML = data.map(p => adviceCard(p,'advice')).join('');
  } catch(e) { console.error(e); el.innerHTML = emptyState('âš ï¸','èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼','ã—ã°ã‚‰ãå¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',false); }
}

// â”€â”€ åˆæ ¼ä½“é¨“è¨˜ â”€â”€
async function loadTaikenkiPosts() {
  const el = document.getElementById('taikenki-posts');
  if (!db) { el.innerHTML = emptyState('ğŸ†','ä½“é¨“è¨˜ã‚’å‹Ÿé›†ä¸­','åˆæ ¼ã—ãŸå…ˆè¼©ã®çš†ã•ã‚“ã€ä½“é¨“è¨˜ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚',false); return; }
  try {
    const { data, error } = await db.from('posts').select('*')
      .eq('category','juken').eq('circle_type','taikenki')
      .order('created_at',{ascending:false}).limit(9);
    if (error) throw error;
    if (!data || !data.length) {
      el.innerHTML = emptyState('ğŸ†','ã¾ã ä½“é¨“è¨˜ãŒã‚ã‚Šã¾ã›ã‚“','åˆæ ¼ã—ãŸå…ˆè¼©ã®çš†ã•ã‚“ã€ãœã²ä½“é¨“è¨˜ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„ï¼',true);
      return;
    }
    el.innerHTML = data.map(p => adviceCard(p,'taikenki')).join('');
  } catch(e) { console.error(e); el.innerHTML = emptyState('âš ï¸','èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼','ã—ã°ã‚‰ãå¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚',false); }
}

function adviceCard(p, type) {
  const tagLabel = type === 'advice' ? 'ğŸ“– ã‚¢ãƒ‰ãƒã‚¤ã‚¹' : 'ğŸ† åˆæ ¼ä½“é¨“è¨˜';
  const tagClass = type === 'advice' ? 'tag-advice' : 'tag-taikenki';
  const facultyTag = p.faculty ? `<span class="card-tag tag-faculty">${escHtml(FACULTIES[p.faculty]||p.faculty)}</span>` : '';
  const title = p.title && p.title !== p.body.slice(0,40) ? p.title : p.body.slice(0,30)+'â€¦';
  return `<div class="advice-card">
    <div class="card-tags"><span class="card-tag ${tagClass}">${tagLabel}</span>${facultyTag}</div>
    <div class="advice-card-title">${escHtml(title)}</div>
    <div class="advice-card-body">${escHtml(p.body)}</div>
    <div class="advice-card-meta">
      <span>@${escHtml(p.author)}</span>
      <span>${formatTime(p.created_at)}</span>
      <span>â¤ï¸ ${p.likes||0}</span>
    </div>
  </div>`;
}

function emptyState(icon, title, text, showLink) {
  return `<div class="empty-state">
    <div class="empty-state-icon">${icon}</div>
    <div class="empty-state-title">${title}</div>
    <div class="empty-state-text">${text}</div>
    ${showLink ? `<a href="https://waseda-ten.vercel.app/" class="empty-state-btn">åœ¨å­¦ç”Ÿæ²ç¤ºæ¿ã§æŠ•ç¨¿ã™ã‚‹</a>` : ''}
  </div>`;
}

// â”€â”€ å—é¨“ç”Ÿæ²ç¤ºæ¿ â”€â”€
let boardPosts = [];

async function loadBoardPosts() {
  const el = document.getElementById('board-posts');
  if (!db) { el.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã¾ã›ã‚“</div>'; return; }
  try {
    const { data, error } = await db.from('posts').select('*')
      .eq('category','juken')
      .order('created_at',{ascending:false}).limit(40);
    if (error) throw error;
    boardPosts = (data || []).filter(p => p.circle_type !== 'advice' && p.circle_type !== 'taikenki');
    renderBoardPosts();
  } catch(e) {
    console.error(e);
    document.getElementById('board-posts').innerHTML = '<div class="loading">èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
  }
}

function renderBoardPosts() {
  const el = document.getElementById('board-posts');
  if (!boardPosts.length) {
    el.innerHTML = `<div class="empty-state">
      <div class="empty-state-icon">ğŸ’¬</div>
      <div class="empty-state-title">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
      <div class="empty-state-text">æœ€åˆã®æŠ•ç¨¿è€…ã«ãªã‚Šã¾ã›ã‚“ã‹ï¼Ÿ</div>
    </div>`;
    return;
  }
  const likedSet = getLikedPosts();
  el.innerHTML = boardPosts.map(p => {
    const typeClass = TYPE_CLASSES[p.circle_type] || 'type-zatsudan';
    const typeTag = p.circle_type ? `<span class="board-type-tag ${typeClass}">${escHtml(p.circle_type)}</span>` : '';
    const facultyTag = p.faculty ? `<span class="board-faculty-tag">${escHtml(FACULTIES[p.faculty]||p.faculty)}</span>` : '';
    const likedCls = likedSet.has(String(p.id)) ? ' liked' : '';
    return `<div class="board-card">
      <div class="board-card-meta">
        ${typeTag}${facultyTag}
        <span class="board-card-author">@${escHtml(p.author)}</span>
        <span class="board-card-time">${formatTime(p.created_at)}</span>
      </div>
      <div class="board-card-body">${escHtml(p.body)}</div>
      <div class="board-card-footer">
        <span class="board-like${likedCls}" onclick="likeBoardPost(${JSON.stringify(p.id)}, this)">â¤ï¸ <span class="like-num">${p.likes||0}</span></span>
        <span class="board-comment-count">ğŸ’¬ ${p.comments||0}</span>
      </div>
    </div>`;
  }).join('');
}

async function likeBoardPost(id, el) {
  if (!db) return;
  const alreadyLiked = getLikedPosts().has(String(id));
  const numEl = el.querySelector('.like-num');
  const cur = numEl ? parseInt(numEl.textContent||'0') : 0;
  const newCount = alreadyLiked ? Math.max(0, cur-1) : cur+1;
  if (numEl) numEl.textContent = newCount;
  el.classList.toggle('liked', !alreadyLiked);
  setPostLiked(id, !alreadyLiked);
  const { error } = await db.from('posts').update({ likes: newCount }).eq('id', id);
  if (error) {
    if (numEl) numEl.textContent = cur;
    el.classList.toggle('liked', alreadyLiked);
    setPostLiked(id, alreadyLiked);
  }
}

async function submitBoardPost() {
  const nickname = document.getElementById('boardNickname').value.trim();
  const faculty  = document.getElementById('boardFaculty').value;
  const type     = document.getElementById('boardType').value;
  const body     = document.getElementById('boardBody').value.trim();

  if (!nickname) { alert('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  if (!type)     { alert('æŠ•ç¨¿ç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  if (!body)     { alert('æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  if (body.length < 5) { alert('ã‚‚ã†å°‘ã—è©³ã—ãæ›¸ã„ã¦ã¿ã¦ãã ã•ã„'); return; }
  if (!db)       { alert('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã¾ã›ã‚“'); return; }

  const btn = document.getElementById('boardSubmitBtn');
  btn.disabled = true; btn.textContent = 'æŠ•ç¨¿ä¸­...';
  try {
    const { error } = await db.from('posts').insert([{
      category: 'juken', author: nickname, title: body.slice(0, 40), body,
      faculty: faculty || null, circle_type: type, likes: 0, comments: 0, device_id: getDeviceId()
    }]);
    if (error) throw error;
    document.getElementById('boardNickname').value = '';
    document.getElementById('boardFaculty').value  = '';
    document.getElementById('boardType').value     = '';
    document.getElementById('boardBody').value     = '';
    await loadBoardPosts();
    document.getElementById('board-posts').scrollIntoView({ behavior: 'smooth' });
  } catch(e) {
    console.error(e);
    alert('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦ãŠè©¦ã—ãã ã•ã„ã€‚');
  } finally {
    btn.disabled = false; btn.textContent = 'æŠ•ç¨¿ã™ã‚‹';
  }
}

// â”€â”€ åˆæœŸåŒ– â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  renderFacultyGrid();
  loadAdvicePosts();
  loadTaikenkiPosts();
  loadBoardPosts();
});
</script>
</body>
</html>
